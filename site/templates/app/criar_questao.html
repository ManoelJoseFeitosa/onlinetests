{% extends 'app/base.html' %}

{% block title %}Criar Nova Questão{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="h3">Criar Nova Questão</h1>
        <a href="{{ url_for('main_routes.banco_questoes') }}" class="btn btn-secondary">
            <i class="bi bi-arrow-left me-1"></i> Voltar ao Banco
        </a>
    </div>

    <div class="card shadow-sm">
        <div class="card-body">
            <form method="POST" action="{{ url_for('main_routes.criar_questao') }}" enctype="multipart/form-data">
                
                <!-- Linha 1: Disciplina e Série -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="disciplina_id" class="form-label">1. Disciplina *</label>
                        <select class="form-select" id="disciplina_id" name="disciplina_id" required>
                            <option value="" disabled selected>-- Selecione uma Disciplina --</option>
                            {% for disciplina in disciplinas %}
                            <option value="{{ disciplina.id }}">{{ disciplina.nome }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="serie_id" class="form-label">2. Série de Aplicação *</label>
                        <select class="form-select" id="serie_id" name="serie_id" required>
                            <option value="" disabled selected>-- Selecione uma Série --</option>
                            {% for serie in series %}
                            <option value="{{ serie.id }}">{{ serie.nome }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <!-- Linha 2: Assunto -->
                <div class="row mb-3">
                    <div class="col-12">
                        <label for="assunto" class="form-label">3. Assunto *</label>
                        <input type="text" class="form-control" id="assunto" name="assunto" placeholder="Ex: Análise Sintática, Renascimento" required>
                    </div>
                </div>

                <!-- Linha 3: Tipo e Nível -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="tipo" class="form-label">4. Tipo de Questão *</label>
                        <select class="form-select" id="tipo" name="tipo" required>
                            <option value="multipla_escolha">Múltipla Escolha</option>
                            <option value="verdadeiro_falso">Verdadeiro ou Falso</option>
                            <option value="discursiva">Discursiva</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="nivel" class="form-label">5. Nível de Dificuldade *</label>
                        <select class="form-select" id="nivel" name="nivel" required>
                            <option value="facil">Fácil</option>
                            <option value="media" selected>Média</option>
                            <option value="dificil">Difícil</option>
                        </select>
                    </div>
                </div>

                <!-- Linha 4: Enunciado -->
                <div class="mb-3">
                    <label for="texto_questao" class="form-label">6. Enunciado da Questão *</label>
                    <textarea class="form-control" id="texto_questao" name="texto_questao" rows="5" required></textarea>
                </div>

                <!-- Linha 5: Imagem (Opcional) -->
                <div class="mb-3 p-3 border rounded bg-light">
                    <label class="form-label fw-bold">7. Imagem da Questão (Opcional)</label>
                    <div class="mb-2">
                        <label for="imagem_questao" class="form-label">Envie uma imagem para complementar o enunciado.</label>
                        <input class="form-control" type="file" id="imagem_questao" name="imagem_questao" accept="image/png, image/jpeg, image/gif">
                    </div>
                    <div>
                        <label for="imagem_alt" class="form-label">Descrição da imagem (para acessibilidade)</label>
                        <input type="text" class="form-control" id="imagem_alt" name="imagem_alt" placeholder="Ex: Gráfico de barras crescente, Mapa do Brasil destacando a Região Nordeste.">
                        <div class="form-text">Este texto é lido por leitores de tela para alunos com deficiência visual.</div>
                    </div>
                </div>

                <!-- Campos Dinâmicos: Opções de Resposta e Gabarito -->
                <div id="campos-resposta">
                    <!-- Container para Opções de Múltipla Escolha -->
                    <div id="opcoes-multipla-escolha" class="mb-3">
                        <label class="form-label fw-bold">Opções de Resposta</label>
                        <div class="input-group mb-2">
                            <span class="input-group-text">A</span>
                            <input type="text" class="form-control" name="opcao_a" placeholder="Texto da opção A">
                        </div>
                        <div class="input-group mb-2">
                            <span class="input-group-text">B</span>
                            <input type="text" class="form-control" name="opcao_b" placeholder="Texto da opção B">
                        </div>
                        <div class="input-group mb-2">
                            <span class="input-group-text">C</span>
                            <input type="text" class="form-control" name="opcao_c" placeholder="Texto da opção C">
                        </div>
                        <div class="input-group">
                            <span class="input-group-text">D</span>
                            <input type="text" class="form-control" name="opcao_d" placeholder="Texto da opção D">
                        </div>
                    </div>

                    <!-- Container para o Gabarito -->
                    <div id="campo-gabarito" class="mb-3">
                        <label for="gabarito" class="form-label">Gabarito *</label>
                        <input type="text" class="form-control" id="gabarito" name="gabarito" style="text-transform:uppercase" maxlength="1">
                    </div>
                </div>

                <!-- Linha Final: Justificativa e Botão -->
                <div class="mb-3">
                    <label for="justificativa_gabarito" class="form-label">Justificativa do Gabarito (Opcional)</label>
                    <textarea class="form-control" id="justificativa_gabarito" name="justificativa_gabarito" rows="3" placeholder="Explique por que a alternativa correta é a certa. Isso pode ser exibido ao aluno após a correção."></textarea>
                </div>

                <div class="d-grid">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="bi bi-check-circle me-2"></i>Salvar Questão
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const tipoQuestaoSelect = document.getElementById('tipo');
    const opcoesMultiplaEscolha = document.getElementById('opcoes-multipla-escolha');
    const campoGabarito = document.getElementById('campo-gabarito');
    const inputGabarito = document.getElementById('gabarito');

    function toggleCamposPorTipo() {
        const tipoSelecionado = tipoQuestaoSelect.value;

        if (tipoSelecionado === 'multipla_escolha') {
            opcoesMultiplaEscolha.style.display = 'block';
            campoGabarito.style.display = 'block';
            inputGabarito.placeholder = 'Gabarito (A, B, C ou D)';
            // Torna os campos de múltipla escolha obrigatórios
            document.getElementsByName('opcao_a')[0].required = true;
            document.getElementsByName('opcao_b')[0].required = true;
            document.getElementsByName('opcao_c')[0].required = true;
            document.getElementsByName('opcao_d')[0].required = true;
            inputGabarito.required = true;
        } else if (tipoSelecionado === 'verdadeiro_falso') {
            opcoesMultiplaEscolha.style.display = 'none';
            campoGabarito.style.display = 'block';
            inputGabarito.placeholder = 'Gabarito (V ou F)';
            // Remove a obrigatoriedade dos campos de múltipla escolha
            document.getElementsByName('opcao_a')[0].required = false;
            document.getElementsByName('opcao_b')[0].required = false;
            document.getElementsByName('opcao_c')[0].required = false;
            document.getElementsByName('opcao_d')[0].required = false;
            inputGabarito.required = true;
        } else if (tipoSelecionado === 'discursiva') {
            opcoesMultiplaEscolha.style.display = 'none';
            campoGabarito.style.display = 'none';
            // Remove a obrigatoriedade de todos os campos de resposta
            document.getElementsByName('opcao_a')[0].required = false;
            document.getElementsByName('opcao_b')[0].required = false;
            document.getElementsByName('opcao_c')[0].required = false;
            document.getElementsByName('opcao_d')[0].required = false;
            inputGabarito.required = false;
        }
    }

    // Adiciona o listener para o evento de mudança
    tipoQuestaoSelect.addEventListener('change', toggleCamposPorTipo);

    // Chama a função uma vez no carregamento da página para definir o estado inicial
    toggleCamposPorTipo();
});
</script>
{% endblock %}
