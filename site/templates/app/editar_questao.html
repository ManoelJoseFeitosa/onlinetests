{% extends 'app/base.html' %}

{% block title %}Criar Nova Questão{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Criar Nova Questão</h2>
        <a href="{{ url_for('main_routes.banco_questoes') }}" class="btn btn-outline-secondary">&larr; Voltar ao Banco de Questões</a>
    </div>

    <form method="POST" action="{{ url_for('main_routes.criar_questao') }}">
        <div class="card shadow-sm">
            <div class="card-body p-4">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="disciplina_id" class="form-label">Disciplina</label>
                        <select id="disciplina_id" name="disciplina_id" class="form-select" required>
                            <option value="" disabled selected>-- Selecione a Disciplina --</option>
                            {% for disciplina in disciplinas %}
                                <option value="{{ disciplina.id }}">{{ disciplina.nome }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="serie_id" class="form-label">Série de Aplicação</label>
                        <select id="serie_id" name="serie_id" class="form-select" required>
                            <option value="" disabled selected>-- Selecione a Série --</option>
                            {% for serie in series %}
                                <option value="{{ serie.id }}">{{ serie.nome }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="mb-3">
                    <label for="assunto" class="form-label">Assunto</label>
                    <input type="text" id="assunto" name="assunto" class="form-control" placeholder="Ex: Genética, Ecologia, Análise Sintática" required>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="tipo" class="form-label">Tipo de Questão</label>
                        <select id="tipo" name="tipo" class="form-select" required>
                            <option value="multipla_escolha" selected>Múltipla Escolha</option>
                            <option value="verdadeiro_falso">Verdadeiro ou Falso</option>
                            <option value="discursiva" disabled>Discursiva (em breve)</option>
                        </select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="nivel" class="form-label">Nível de Dificuldade</label>
                        <select id="nivel" name="nivel" class="form-select" required>
                            <option value="facil">Fácil</option>
                            <option value="media" selected>Média</option>
                            <option value="dificil">Difícil</option>
                        </select>
                    </div>
                </div>
                
                <div class="mb-3">
                    <label for="texto_questao" class="form-label">Enunciado da Questão</label>
                    <textarea id="texto_questao" name="texto_questao" rows="4" class="form-control" required></textarea>
                </div>

                <!-- Campos de Resposta -->
                <div id="multipla_escolha_fields">
                    <h6>Opções de Resposta (Múltipla Escolha)</h6>
                    <div class="input-group mb-2">
                        <span class="input-group-text">A</span>
                        <input type="text" name="opcao_a" class="form-control" required>
                    </div>
                    <div class="input-group mb-2">
                        <span class="input-group-text">B</span>
                        <input type="text" name="opcao_b" class="form-control" required>
                    </div>
                    <div class="input-group mb-2">
                        <span class="input-group-text">C</span>
                        <input type="text" name="opcao_c" class="form-control" required>
                    </div>
                    <div class="input-group mb-2">
                        <span class="input-group-text">D</span>
                        <input type="text" name="opcao_d" class="form-control" required>
                    </div>
                </div>

                <div id="gabarito_fields" class="mt-3">
                    <label for="gabarito" class="form-label fw-bold">Gabarito</label>
                    <div id="gabarito_multipla_escolha">
                        <select name="gabarito" class="form-select" style="width: 150px;" required>
                            <option value="A" selected>A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                            <option value="D">D</option>
                        </select>
                    </div>
                    <div id="gabarito_vf" style="display: none;">
                        <select name="gabarito" class="form-select" style="width: 200px;" disabled>
                            <option value="A" selected>Verdadeiro</option>
                            <option value="B">Falso</option>
                        </select>
                    </div>
                </div>

                <div class="text-center mt-4">
                    <button type="submit" class="btn btn-primary btn-lg">Salvar Nova Questão</button>
                </div>
            </div>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const tipoQuestaoSelect = document.getElementById('tipo');
    
    // Campos de Múltipla Escolha
    const multiplaEscolhaContainer = document.getElementById('multipla_escolha_fields');
    const multiplaEscolhaInputs = multiplaEscolhaContainer.querySelectorAll('input');
    const gabaritoMultiplaSelect = document.getElementById('gabarito_multipla_escolha').querySelector('select');

    // Campos de Verdadeiro/Falso
    const gabaritoVfContainer = document.getElementById('gabarito_vf');
    const gabaritoVfSelect = gabaritoVfContainer.querySelector('select');

    function toggleFields() {
        const selectedType = tipoQuestaoSelect.value;

        if (selectedType === 'multipla_escolha') {
            // Mostra campos de múltipla escolha e seu gabarito
            multiplaEscolhaContainer.style.display = 'block';
            gabaritoMultiplaSelect.parentElement.style.display = 'block';
            
            // Esconde gabarito de V/F
            gabaritoVfContainer.style.display = 'none';

            // Define os campos como obrigatórios ou não
            multiplaEscolhaInputs.forEach(input => input.required = true);
            gabaritoMultiplaSelect.required = true;
            gabaritoVfSelect.required = false;
            gabaritoVfSelect.disabled = true;
            gabaritoMultiplaSelect.disabled = false;


        } else if (selectedType === 'verdadeiro_falso') {
            // Esconde campos de múltipla escolha e seu gabarito
            multiplaEscolhaContainer.style.display = 'none';
            gabaritoMultiplaSelect.parentElement.style.display = 'none';

            // Mostra gabarito de V/F
            gabaritoVfContainer.style.display = 'block';

            // Define os campos como obrigatórios ou não
            multiplaEscolhaInputs.forEach(input => input.required = false);
            gabaritoMultiplaSelect.required = false;
            gabaritoVfSelect.required = true;
            gabaritoVfSelect.disabled = false;
            gabaritoMultiplaSelect.disabled = true;
        }
    }

    tipoQuestaoSelect.addEventListener('change', toggleFields);
    
    // Executa a função ao carregar a página para definir o estado inicial correto
    toggleFields(); 
});
</script>
{% endblock %}
