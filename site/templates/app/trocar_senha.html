{% extends 'app/base.html' %}

{% block title %}Atualizar Senha - OnlineTests{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <div class="card shadow-sm">
                <div class="card-body p-4">
                    <h3 class="card-title text-center mb-2">Crie sua nova senha de acesso</h3>
                    <p class="text-center text-muted mb-4">Por segurança, este é um passo obrigatório no seu primeiro acesso.</p>

                    <!-- Formulário de Troca de Senha -->
                    <!-- CORREÇÃO APLICADA AQUI -->
                    <form method="POST" action="{{ url_for('main_routes.trocar_senha') }}" novalidate>
                        {{ form.hidden_tag() }}

                        <div class="mb-3">
                            {{ form.password.label(class="form-label fw-bold") }}
                            {{ form.password(class="form-control" + (" is-invalid" if form.password.errors else ""), placeholder="Digite sua nova senha") }}
                            {% if form.password.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.password.errors %}<span>{{ error }}</span>{% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <div class="mb-3">
                            {{ form.confirm_password.label(class="form-label fw-bold") }}
                            {{ form.confirm_password(class="form-control" + (" is-invalid" if form.confirm_password.errors else ""), placeholder="Confirme a nova senha") }}
                            {% if form.confirm_password.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.confirm_password.errors %}<span>{{ error }}</span>{% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <hr>

                        <!-- Seção de Aceite dos Termos de Uso -->
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" value="aceito" id="aceite_termos" name="aceite_termos">
                            <label class="form-check-label" for="aceite_termos">
                                Eu li e concordo com os 
                                <a href="#" data-bs-toggle="modal" data-bs-target="#termosModal">
                                    Termos de Uso e Política de Privacidade
                                </a>.
                            </label>
                        </div>
                        
                        <!-- Botão de Envio (inicialmente desabilitado) -->
                        <div class="d-grid">
                            {{ form.submit(class="btn btn-primary", id="submit-btn", disabled=True, value="Atualizar Senha") }}
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal com os Termos de Uso -->
<div class="modal fade" id="termosModal" tabindex="-1" aria-labelledby="termosModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="termosModalLabel">Termos de Uso e Política de Privacidade</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h6>Última atualização: 23 de julho de 2025</h6>
                <p><strong>Bem-vindo(a) à plataforma OnlineTests!</strong></p>
                <p>Este documento estabelece os Termos de Uso e a Política de Privacidade da plataforma OnlineTests ("Plataforma"), desenvolvida e mantida por MANOEL JOSE FEITOSA NETO, pessoa jurídica de direito privado, inscrita no CNPJ sob o nº 61.777.358/0001-10, doravante denominada "Controladora".</p>
                <p>A leitura atenta e a aceitação destes termos são indispensáveis para a utilização dos nossos serviços.</p>
                <!-- O restante do texto dos termos foi omitido para brevidade -->
                <h5>1. DEFINIÇÕES IMPORTANTES (LGPD)</h5>
                ...
                <h5>11. FORO</h5>
                <p>Para a resolução de quaisquer controvérsias decorrentes destes Termos, será competente o foro da comarca de Teresina, Estado do Piauí, Brasil.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Pega os elementos do DOM
    const checkboxTermos = document.getElementById('aceite_termos');
    const submitButton = document.getElementById('submit-btn');

    // Adiciona um 'escutador' de eventos ao checkbox
    checkboxTermos.addEventListener('change', function() {
        // Habilita ou desabilita o botão de submit com base no estado do checkbox
        submitButton.disabled = !checkboxTermos.checked;
    });
});
</script>
{% endblock %}
