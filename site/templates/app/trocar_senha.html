{% extends 'app/base.html' %}

{% block title %}Atualizar Senha - OnlineTests{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <div class="card shadow-sm">
                <div class="card-body p-4">
                    <h3 class="card-title text-center mb-2">Crie sua nova senha de acesso</h3>
                    <p class="text-center text-muted mb-4">Por segurança, este é um passo obrigatório no seu primeiro acesso.</p>

                    <!-- Formulário de Troca de Senha -->
                    <form method="POST" action="{{ url_for('trocar_senha') }}" novalidate>
                        {{ form.hidden_tag() }}

                        <div class="mb-3">
                            {{ form.password.label(class="form-label fw-bold") }}
                            {{ form.password(class="form-control" + (" is-invalid" if form.password.errors else ""), placeholder="Digite sua nova senha") }}
                            {% if form.password.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.password.errors %}<span>{{ error }}</span>{% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <div class="mb-3">
                            {{ form.confirm_password.label(class="form-label fw-bold") }}
                            {{ form.confirm_password(class="form-control" + (" is-invalid" if form.confirm_password.errors else ""), placeholder="Confirme a nova senha") }}
                            {% if form.confirm_password.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.confirm_password.errors %}<span>{{ error }}</span>{% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <hr>

                        <!-- Seção de Aceite dos Termos de Uso -->
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" value="aceito" id="aceite_termos" name="aceite_termos">
                            <label class="form-check-label" for="aceite_termos">
                                Eu li e concordo com os 
                                <a href="#" data-bs-toggle="modal" data-bs-target="#termosModal">
                                    Termos de Uso e Política de Privacidade
                                </a>.
                            </label>
                        </div>
                        
                        <!-- Botão de Envio (inicialmente desabilitado) -->
                        <div class="d-grid">
                            {{ form.submit(class="btn btn-primary", id="submit-btn", disabled=True, value="Atualizar Senha") }}
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal com os Termos de Uso -->
<div class="modal fade" id="termosModal" tabindex="-1" aria-labelledby="termosModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="termosModalLabel">Termos de Uso e Política de Privacidade</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h6>Última atualização: 23 de julho de 2025</h6>
                <p><strong>Bem-vindo(a) à plataforma OnlineTests!</strong></p>
                <p>Este documento estabelece os Termos de Uso e a Política de Privacidade da plataforma OnlineTests ("Plataforma"), desenvolvida e mantida por MANOEL JOSE FEITOSA NETO, pessoa jurídica de direito privado, inscrita no CNPJ sob o nº 61.777.358/0001-10, doravante denominada "Controladora".</p>
                <p>A leitura atenta e a aceitação destes termos são indispensáveis para a utilização dos nossos serviços.</p>

                <h5>1. DEFINIÇÕES IMPORTANTES (LGPD)</h5>
                <ul>
                    <li><strong>Dado Pessoal:</strong> Qualquer informação relacionada a uma pessoa natural identificada ou identificável.</li>
                    <li><strong>Titular:</strong> Pessoa natural a quem se referem os dados pessoais que são objeto de tratamento.</li>
                    <li><strong>Controlador:</strong> Pessoa natural ou jurídica a quem competem as decisões referentes ao tratamento de dados pessoais. Neste caso, a MANOEL JOSE FEITOSA NETO.</li>
                    <li><strong>Operador:</strong> Pessoa natural ou jurídica que realiza o tratamento de dados pessoais em nome do Controlador. Neste caso, a Instituição de Ensino contratante.</li>
                    <li><strong>Tratamento:</strong> Toda operação realizada com dados pessoais, como coleta, produção, recepção, classificação, utilização, acesso, reprodução, transmissão, distribuição, processamento, arquivamento, armazenamento, eliminação, avaliação ou controle da informação, modificação, comunicação, transferência, difusão ou extração.</li>
                    <li><strong>LGPD:</strong> Lei Geral de Proteção de Dados (Lei nº 13.709/2018).</li>
                </ul>

                <h5>2. ACEITAÇÃO DOS TERMOS</h5>
                <p>Ao acessar e utilizar a Plataforma OnlineTests, seja como Coordenador, Professor ou Aluno, você declara ter lido, compreendido e concordado integralmente com as disposições destes Termos de Uso e Política de Privacidade. Caso não concorde com qualquer um dos termos, você não deverá utilizar a Plataforma.</p>

                <h5>3. DADOS PESSOAIS COLETADOS E FINALIDADE</h5>
                <p>A Plataforma coleta e trata os seguintes dados pessoais, com as respectivas finalidades:</p>
                <h6>Dados de Cadastro (Coordenadores, Professores e Alunos):</h6>
                <ul>
                    <li><strong>Dados Coletados:</strong> Nome completo, e-mail, senha (criptografada).</li>
                    <li><strong>Finalidade:</strong> Identificar o usuário, permitir o acesso seguro à Plataforma, gerir as permissões de cada perfil (criar provas, responder avaliações, visualizar resultados) e garantir a comunicação entre a Plataforma e o usuário.</li>
                </ul>
                <h6>Dados de Desempenho Acadêmico (Alunos):</h6>
                <ul>
                    <li><strong>Dados Coletados:</strong> Respostas fornecidas em avaliações, notas, data e hora de realização, status (pendente, finalizado).</li>
                    <li><strong>Finalidade:</strong> Processar e calcular os resultados das avaliações, gerar relatórios de desempenho individuais e por turma, e fornecer aos Professores e Coordenadores as ferramentas necessárias para a análise pedagógica.</li>
                </ul>
                <h6>Dados de Navegação (Todos os Usuários):</h6>
                <ul>
                    <li><strong>Dados Coletados:</strong> Endereço de IP, tipo de navegador, data e hora dos acessos.</li>
                    <li><strong>Finalidade:</strong> Garantir a segurança da Plataforma, auditar acessos (conforme descrito na Seção 4), prevenir fraudes e otimizar a experiência do usuário.</li>
                </ul>
                <p>A base legal para o tratamento destes dados é a execução de contrato (Art. 7º, V, da LGPD), uma vez que o tratamento é indispensável para a prestação dos serviços educacionais contratados pela Instituição de Ensino.</p>

                <h5>4. SEGURANÇA E AUDITORIA</h5>
                <p>A Plataforma conta com mecanismos de segurança para proteger os dados e a integridade do processo avaliativo, incluindo:</p>
                <ul>
                    <li><strong>Acesso Seguro:</strong> Acesso mediante e-mail e senha, com a senha armazenada de forma criptografada.</li>
                    <li><strong>Prevenção de Fraudes:</strong> O sistema monitoriza tentativas de saída do modo de tela cheia durante as avaliações, bloqueando a prova para garantir a lisura do processo.</li>
                    <li><strong>Auditoria de Acessos:</strong> Todos os acessos e ações relevantes (criação de questões, realização de provas, correções) são registados com data, hora e endereço de IP, estando disponíveis para a Coordenação para fins de auditoria e segurança.</li>
                </ul>

                <h5>5. COMPARTILHAMENTO DE DADOS</h5>
                <p>A Controladora não compartilha os dados pessoais dos usuários com terceiros para fins de marketing ou publicidade. O compartilhamento de dados ocorre estritamente nos seguintes cenários:</p>
                <ul>
                    <li><strong>Com a Instituição de Ensino (Operadora):</strong> Os dados de cadastro e desempenho dos alunos e professores são inerentemente visíveis e gerenciados pela própria instituição de ensino contratante, que atua como Operadora dos dados no contexto educacional.</li>
                    <li><strong>Por Obrigação Legal:</strong> Os dados poderão ser compartilhados com autoridades judiciais, administrativas ou governamentais competentes, sempre que houver requerimento, requisição ou ordem judicial.</li>
                </ul>

                <h5>6. DIREITOS DOS TITULARES DE DADOS</h5>
                <p>Conforme a LGPD, os titulares de dados (você) têm o direito de solicitar, a qualquer momento:</p>
                <ul>
                    <li>A confirmação da existência de tratamento dos seus dados.</li>
                    <li>O acesso aos seus dados.</li>
                    <li>A correção de dados incompletos, inexatos ou desatualizados.</li>
                    <li>A anonimização, bloqueio ou eliminação de dados desnecessários ou excessivos.</li>
                    <li>A portabilidade dos seus dados a outro fornecedor de serviço.</li>
                    <li>A eliminação dos dados pessoais tratados com o seu consentimento.</li>
                    <li>Informações sobre as entidades com as quais a Controladora realizou uso compartilhado de dados.</li>
                </ul>
                <p>Para exercer os seus direitos, o titular deverá entrar em contato através dos canais disponibilizados na Seção 9. As solicitações serão atendidas em conformidade com os prazos e disposições da LGPD.</p>

                <h5>7. SEGURANÇA E ARMAZENAMENTO DOS DADOS</h5>
                <p>A Controladora adota medidas de segurança técnicas e administrativas aptas a proteger os dados pessoais de acessos não autorizados e de situações acidentais ou ilícitas de destruição, perda, alteração, comunicação ou difusão. Os dados são armazenados em servidores seguros, e o acesso é restrito aos colaboradores e sistemas que necessitam da informação para executar as finalidades aqui descritas.</p>

                <h5>8. PROPRIEDADE INTELECTUAL</h5>
                <p>Todo o conteúdo da Plataforma OnlineTests, incluindo, mas não se limitando a, software, textos, gráficos, imagens, logotipos e ícones, é de propriedade exclusiva da MANOEL JOSE FEITOSA NETO ou de seus licenciadores e é protegido pelas leis de propriedade intelectual.</p>
                <p>É expressamente proibida a cópia, reprodução, modificação, distribuição ou qualquer outra forma de utilização do conteúdo da Plataforma sem a autorização prévia e por escrito da Controladora.</p>

                <h5>9. ALTERAÇÕES NESTES TERMOS</h5>
                <p>A Controladora reserva-se o direito de alterar estes Termos de Uso e Política de Privacidade a qualquer momento. A versão atualizada estará sempre disponível na Plataforma, e os usuários serão notificados sobre alterações relevantes. O uso contínuo da Plataforma após a publicação de uma nova versão constitui a aceitação dos novos termos.</p>

                <h5>10. CONTATO</h5>
                <p>Para exercer seus direitos de titular, ou para esclarecer quaisquer dúvidas sobre estes Termos, entre em contato com o nosso Encarregado pela Proteção de Dados (DPO) através do e-mail: contato@onlinetests.com.br.</p>

                <h5>11. FORO</h5>
                <p>Para a resolução de quaisquer controvérsias decorrentes destes Termos, será competente o foro da comarca de Teresina, Estado do Piauí, Brasil.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Pega os elementos do DOM
    const checkboxTermos = document.getElementById('aceite_termos');
    const submitButton = document.getElementById('submit-btn');

    // Adiciona um 'escutador' de eventos ao checkbox
    checkboxTermos.addEventListener('change', function() {
        // Habilita ou desabilita o botão de submit com base no estado do checkbox
        // A propriedade 'disabled' será 'true' se o checkbox NÃO estiver marcado
        // e 'false' se estiver marcado.
        submitButton.disabled = !checkboxTermos.checked;
    });
});
</script>
{% endblock %}
